<!doctype html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Envio de Fotos - Avarias</title>
<style>
  body{font-family:Arial; background:#f4f6f8; padding:30px; display:flex; justify-content:center}
  .card{background:#fff; padding:18px; border-radius:12px; box-shadow:0 4px 18px rgba(0,0,0,0.08); width:100%; max-width:420px}
  input, button{width:100%; padding:10px; margin:8px 0; border-radius:8px; border:1px solid #ccc}
  button{background:#0b74ff;color:white;border:0;font-weight:700}
  #status{margin-top:12px;font-weight:600}
</style>
</head>
<body>
<div class="card">
  <h2 style="text-align:center">üì∏ Envio de Fotos - Avarias</h2>
  <input id="or" placeholder="N√∫mero da OR (obrigat√≥rio)">
  <input id="nf" placeholder="Nota Fiscal (opcional)">
  <input id="codvar" placeholder="COD + VARIA√á√ÉO (obrigat√≥rio)">
  <input id="files" type="file" accept="image/*" multiple>
  <button id="send">Enviar Fotos</button>
  <div id="status"></div>
</div>

<script>
const APPS_SCRIPT_URL = "COLE_AQUI_O_URL_DO_SEU_WEB_APP"; // <<< editar aqui

document.getElementById('send').addEventListener('click', async () => {
  const or = document.getElementById('or').value.trim();
  const nf = document.getElementById('nf').value.trim() || "SEM_NF";
  const codvar = document.getElementById('codvar').value.trim();
  const input = document.getElementById('files');
  const status = document.getElementById('status');

  if(!or || !codvar) return alert("Preencha OR e COD+VARIA√á√ÉO.");
  if(!input.files.length) return alert("Selecione pelo menos 1 foto.");

  status.textContent = "‚è≥ Convertendo imagens...";
  const filesArr = Array.from(input.files);
  // converte cada arquivo para base64
  const filesToSend = await Promise.all(filesArr.map(file => new Promise((res, rej) => {
    const fr = new FileReader();
    fr.onload = () => {
      const base64 = fr.result.split(',')[1]; // remove header
      res({ filename: file.name, mimeType: file.type, base64: base64 });
    };
    fr.onerror = rej;
    fr.readAsDataURL(file);
  })));

  status.textContent = "‚è≥ Enviando para servidor...";
  try {
    const resp = await fetch(APPS_SCRIPT_URL, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ or: or, nf: nf, codvar: codvar, files: filesToSend })
    });
    const data = await resp.json();
    if(data.success) {
      status.innerHTML = "‚úÖ Fotos enviadas! Pasta: <a href='"+data.folderUrl+"' target='_blank'>Abrir</a>";
      // opcional: limpar campos
      document.getElementById('or').value = "";
      document.getElementById('codvar').value = "";
      input.value = null;
    } else {
      status.textContent = "‚ùå Erro: " + data.message;
    }
  } catch (err) {
    status.textContent = "‚ùå Erro de rede: " + err.message;
  }
});
</script>
</body>
</html>
